import React, { useMemo, useState } from "react";

const fmt = (n) => (Number.isFinite(n) ? n.toLocaleString("en-US") : "–"); const clamp = (v, min, max) => Math.min(Math.max(v, min), max); const proratedByMonths = (apr, months) => apr * (months * 30 / 365);

const COLORS = { ocean: "#4332BD", orange: "#E96742", lace: "#EBEAED", black: "#0B0B0F", };

const PLANS = { gold123: { key: "gold123", name: "طلایی ۱۲۳٪", color: COLORS.orange, type: "termYield", termMonths: 24, termYield: 1.23, minPrincipal: 0, ctaHref: "https://my.repay.pro" }, credit: { key: "credit", name: "طرح اعتبار", color: COLORS.ocean, type: "dailyAPR_withLoan", termMonths: 3, investAPR: 0.25, loanAPR: 0.23, loanFactor: 1/3, minPrincipal: 15_000_000, ctaHref: "https://my.repay.pro" }, vip: { key: "vip", name: "VIP", color: COLORS.black, type: "dailyAPR_flexible", maxAPR: 0.61, minAPR: 0.01, minMonths: 1, maxMonths: 36, minPrincipal: 0, ctaHref: "https://my.repay.pro" }, upfront: { key: "upfront", name: "سود یکجا", color: COLORS.orange, type: "dailyAPR_upfront", termMonths: 5, apr: 0.42, minPrincipal: 10_000_000, ctaHref: "https://my.repay.pro" }, };

const calcTermYield = (P, termYield) => ({ fv: P * (1 + termYield), profit: P * termYield }); const calcDailyAPR = (P, apr, months) => { const r = proratedByMonths(apr, months); return { fv: P * (1 + r), r, profit: P * r }; }; const calcCreditPlan = (P, investAPR, loanAPR, months, loanFactor) => { const { fv, r, profit } = calcDailyAPR(P, investAPR, months); const loanAmount = P * loanFactor; const loanInterest = loanAmount * proratedByMonths(loanAPR, months); return { fv, investRateProrated: r, profit, loanAmount, loanInterest }; }; const calcUpfront = (P, apr, months) => { const r = proratedByMonths(apr, months); const upfrontInterest = P * r; return { r, upfrontInterest, maturityReturn: P }; };

function AppDownloadMenu() { const [open, setOpen] = useState(false); return ( <div className="relative inline-block text-left"> <button onClick={() => setOpen(!open)} className="px-4 py-2 rounded-2xl shadow bg-black text-white text-sm">دانلود اپلیکیشن</button> {open && ( <div className="absolute z-20 mt-2 w-56 rounded-2xl border bg-white shadow-lg p-2"> <a className="block px-3 py-2 rounded-xl hover:bg-gray-100 text-sm" href="https://my.repay.pro" target="_blank" rel="noreferrer">وب اپلیکیشن</a> <a className="block px-3 py-2 rounded-xl hover:bg-gray-100 text-sm" href="http://cafebazaar.ir/app/?id=io.rebix.pay&ref=share" target="_blank" rel="noreferrer">کافه بازار</a> <a className="block px-3 py-2 rounded-xl hover:bg-gray-100 text-sm" href="https://myket.ir/app/io.rebix.pay" target="_blank" rel="noreferrer">مایکت</a> </div> )} </div> ); }

export default function RepayCalculator_New() { const [active, setActive] = useState("gold123"); const [principal, setPrincipal] = useState(50_000_000); const [vipMonths, setVipMonths] = useState(12); const [vipAPR, setVipAPR] = useState(0.3); const plan = PLANS[active]; const minOk = principal >= (plan.minPrincipal || 0);

const outputs = useMemo(() => { switch (plan.type) { case "termYield": return calcTermYield(principal, plan.termYield); case "dailyAPR_withLoan": return calcCreditPlan(principal, plan.investAPR, plan.loanAPR, plan.termMonths, plan.loanFactor); case "dailyAPR_upfront": return calcUpfront(principal, plan.apr, plan.termMonths); case "dailyAPR_flexible": return calcDailyAPR(principal, vipAPR, vipMonths); default: return {}; } }, [plan, principal, vipAPR, vipMonths]);

return ( <div className="min-h-screen w-full bg-[#EBEAED] text-gray-900 p-4 md:p-8"> <div className="max-w-5xl mx-auto"> <header className="flex items-center justify-between mb-6"> <div> <h1 className="text-2xl md:text-3xl font-bold">ماشین‌حساب سود ریپی – نسخه محصولات جدید</h1> <p className="text-sm md:text-base text-gray-600 mt-1">غیرفعال‌سازی برنزی و نقره‌ای، حفظ طلایی ۱۲۳٪، افزودن طرح اعتبار، VIP و سود یکجا.</p> </div> <AppDownloadMenu /> </header>

<div className="flex flex-wrap gap-2 mb-4">
      {Object.values(PLANS).map((p) => (
        <button key={p.key} onClick={() => setActive(p.key)}
          className={`px-4 py-2 rounded-2xl border shadow-sm text-sm transition ${active === p.key ? "ring-2 ring-offset-2" : "opacity-80"}`}
          style={{ borderColor: p.color, color: p.color }}>{p.name}</button>
      ))}
    </div>

    <div className="grid md:grid-cols-2 gap-6">
      <section className="bg-white rounded-2xl shadow p-4 md:p-6">
        <label>
          <span className="block text-sm mb-1">سرمایه (ریال){plan.minPrincipal > 0 && <em className="text-xs text-gray-500"> — حداقل {fmt(plan.minPrincipal)}</em>}</span>
          <input type="number" value={principal} min={0} onChange={(e) => setPrincipal(clamp(parseFloat(e.target.value || "0"), 0, 1e15))} className="w-full border rounded-xl px-3 py-2" />
        </label>

        {plan.type === "dailyAPR_flexible" && (
          <>
            <label>
              <span className="block text-sm mb-1">مدت (ماه)</span>
              <input type="range" min={plan.minMonths} max={plan.maxMonths} value={vipMonths} onChange={(e) => setVipMonths(parseInt(e.target.value))} className="w-full" />
              <div className="text-xs text-gray-600 mt-1">{vipMonths} ماه</div>
            </label>
            <label>
              <span className="block text-sm mb-1">APR سالانه (روزشمار)</span>
              <input type="range" min={plan.minAPR} max={plan.maxAPR} step={0.01} value={vipAPR} onChange={(e) => setVipAPR(parseFloat(e.target.value))} className="w-full" />
              <div className="text-xs text-gray-600 mt-1">{(vipAPR * 100).toFixed(2)}%</div>
            </label>
          </>
        )}
      </section>

      <section className="bg-white rounded-2xl shadow p-4 md:p-6">
        <div className="flex items-center justify-between mb-4">
          <div>
            <div className="text-lg font-semibold" style={{ color: plan.color }}>{plan.name}</div>
          </div>
          <a className="text-xs px-2 py-1 rounded-full" href={plan.ctaHref} target="_blank" rel="noreferrer" style={{ background: plan.color + "20", color: plan.color }}>Repay</a>
        </div>

        {!minOk ? (
          <div className="rounded-xl bg-[#FFF6F6] border border-red-200 p-3 text-sm text-red-700">حداقل مبلغ این طرح {fmt(plan.minPrincipal)} ریال است.</div>
        ) : (
          <>
            {plan.type === "termYield" && (
              <>
                <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">ارزش نهایی</div><div className="text-xl font-bold">{fmt(outputs.fv)} ریال</div></div>
                <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">سود کل</div><div className="text-xl font-bold">{fmt(outputs.profit)} ریال</div></div>
              </>
            )}
            {plan.type === "dailyAPR_withLoan" && (
              <>
                <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">سرمایه + سود</div><div className="text-xl font-bold">{fmt(outputs.fv)} ریال</div></div>
                <div className="grid grid-cols-2 gap-3">
                  <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">وام</div><div className="text-xl font-bold">{fmt(outputs.loanAmount)} ریال</div></div>
                  <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">بهره وام</div><div className="text-xl font-bold">{fmt(outputs.loanInterest)} ریال</div></div>
                </div>
              </>
            )}
            {plan.type === "dailyAPR_flexible" && (
              <>
                <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">ارزش نهایی</div><div className="text-xl font-bold">{fmt(outputs.fv)} ریال</div></div>
                <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">سود</div><div className="text-xl font-bold">{fmt(outputs.profit)} ریال</div></div>
              </>
            )}
            {plan.type === "dailyAPR_upfront" && (
              <>
                <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">سود روز اول</div><div className="text-xl font-bold">{fmt(outputs.upfrontInterest)} ریال</div></div>
                <div className="rounded-xl bg-[#EBEAED] p-3"><div className="text-xs text-gray-500">اصل سرمایه در سررسید</div><div className="text-xl font-bold">{fmt(outputs.maturityReturn)} ریال</div></div>
              </>
            )}
            <a href={plan.ctaHref} target="_blank" rel="noreferrer" className="inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl text-white shadow" style={{ background: plan.color }}>همین الان شروع کن</a>
          </>
        )}
      </section>
    </div>

    <footer className="mt-8 text-center text-xs text-gray-500">Ocean Blue (#4332BD)، Chinese Orange (#E96742)، Lace Cap (#EBEAED) | my.repay.pro</footer>
  </div>
</div>

); }

