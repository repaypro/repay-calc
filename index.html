<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ø³ÙˆØ¯ Ø±ÛŒÙ¾ÛŒ (Ù†Ø³Ø®Ù‡ Ø¬Ø¯ÛŒØ¯)</title>
  <style>
    body {
      font-family: IranSans, sans-serif;
      direction: rtl;
      background-color: #f5f5f5;
      margin: 0; padding: 0; color: #2d0c59; text-align: center;
    }
    .container {
      max-width: 460px; background: #fff; margin: 30px auto; padding: 26px;
      border-radius: 25px; box-shadow: 0 6px 20px rgba(0,0,0,.06);
    }
    img.logo { width: 90px; margin-bottom: 10px; }
    h1 { font-size: 22px; margin: 10px 0; }
    p { font-size: 14px; margin-bottom: 16px; line-height: 1.8; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 6px; }

    select, input[type="text"], input[type="number"] {
      width: 100%; padding: 12px; margin-bottom: 12px; font-size: 15px;
      border-radius: 12px; border: 1px solid #ccc; text-align: right; box-sizing: border-box;
    }
    input[type="text"] { direction: ltr; }
    input[type="range"] { width: 100%; }

    button {
      background-color: #121212; color: #fff; border: none; padding: 14px; font-size: 16px;
      border-radius: 12px; cursor: pointer; width: 100%; margin: 8px 0 16px;
    }
    button:active { transform: translateY(1px); }

    .btn-secondary {
      background: #4332BD; /* Ocean Blue */
    }

    .mini { font-size: 12px; color: #666; }

    .result {
      background-color: #fafafa; padding: 18px; border-radius: 14px; text-align: right; line-height: 1.9;
    }

    .error { color: #d33; font-size: 12px; text-align: right; min-height: 18px; margin: -6px 0 10px; }

    .usage-counter { margin-top: 16px; font-size: 14px; color: #555; }

    .download-wrap { position: relative; display: inline-block; }
    .download-menu {
      position: absolute; top: 110%; inset-inline-end: 0; width: 240px; background: #fff; border: 1px solid #eee;
      border-radius: 14px; box-shadow: 0 10px 24px rgba(0,0,0,.08); padding: 6px; text-align: right; z-index: 10;
    }
    .download-menu a { display: block; padding: 10px 12px; border-radius: 10px; color: #222; text-decoration: none; }
    .download-menu a:hover { background: #f6f6f6; }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://uploadkon.ir/uploads/8c7604_25file-0000000073346243969ca320550ec0a2.png" class="logo" alt="Repay Logo" />
    <h1>Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ø³ÙˆØ¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</h1>
    <p>Ø·Ø±Ø­ Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ø³ÙˆØ¯ØŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ùˆ Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.</p>

    <!-- Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† -->
    <div class="download-wrap" style="margin-bottom:14px;">
      <button class="btn-secondary" id="downloadBtn" type="button">Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</button>
      <div id="downloadMenu" class="download-menu" style="display:none;">
        <a href="https://my.repay.pro" target="_blank" rel="noreferrer noopener">ÙˆØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</a>
        <a href="http://cafebazaar.ir/app/?id=io.rebix.pay&ref=share" target="_blank" rel="noreferrer noopener">Ú©Ø§ÙÙ‡ Ø¨Ø§Ø²Ø§Ø±</a>
        <a href="https://myket.ir/app/io.rebix.pay" target="_blank" rel="noreferrer noopener">Ù…Ø§ÛŒÚ©Øª</a>
      </div>
    </div>

    <div class="row">
      <select id="plan" aria-label="Ø§Ù†ØªØ®Ø§Ø¨ Ø·Ø±Ø­" onchange="onPlanChange()">
        <option value="gold123" selected>ğŸ¥‡ Ø·Ù„Ø§ÛŒÛŒ Û±Û²Û³Ùª</option>
        <option value="credit">ğŸ’³ Ø·Ø±Ø­ Ø§Ø¹ØªØ¨Ø§Ø±</option>
        <option value="vip">â­ VIP (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</option>
        <option value="upfront">ğŸ’  Ø³ÙˆØ¯ ÛŒÚ©Ø¬Ø§</option>
      </select>

      <!-- Ø¨Ø±Ø§ÛŒ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…Ø¯Øª Ø«Ø§Ø¨Øª Ø¯Ø§Ø±Ù†Ø¯ Ø§Ø² Ø§ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… -->
      <select id="duration" aria-label="Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Øª"></select>
    </div>

    <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ VIP -->
    <div id="vipControls" style="display:none; text-align:right; margin-top:-6px;">
      <label class="mini">Ù…Ø¯Øª (Ù…Ø§Ù‡)</label>
      <input id="vipMonths" type="range" min="1" max="36" value="12" oninput="document.getElementById('vipMonthsVal').innerText=this.value">
      <div class="mini">Ù…Ø¯Øª Ø§Ù†ØªØ®Ø§Ø¨ÛŒ: <b><span id="vipMonthsVal">12</span> Ù…Ø§Ù‡</b></div>

      <label class="mini" style="margin-top:8px;">APR Ø³Ø§Ù„Ø§Ù†Ù‡ (Ø±ÙˆØ²Ø´Ù…Ø§Ø±) â€” Ø³Ù‚Ù Û¶Û±Ùª</label>
      <input id="vipAPR" type="range" min="0.01" max="0.61" step="0.01" value="0.30"
             oninput="document.getElementById('vipAPRVal').innerText=(this.value*100).toFixed(2)+'%'">
      <div class="mini">APR Ø§Ù†ØªØ®Ø§Ø¨ÛŒ: <b><span id="vipAPRVal">30.00%</span></b></div>
    </div>

    <input id="amount" type="text" inputmode="numeric" pattern="[0-9]*" autocomplete="off" placeholder="Ù…Ø¨Ù„Øº Ø³Ø±Ù…Ø§ÛŒÙ‡ (ØªÙˆÙ…Ø§Ù†)" />
    <div id="amountError" class="error"></div>

    <button id="calcBtn" type="button" onclick="calculate()">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>

    <div class="result" id="result" aria-live="polite"></div>

    <a id="ctaStart" href="https://my.repay.pro" target="_blank" rel="noreferrer noopener">
      <button type="button">Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† Ø´Ø±ÙˆØ¹ Ú©Ù†</button>
    </a>

    <div class="usage-counter">ğŸ“Š count : <span id="useCount">0</span></div>
  </div>

<script>
  // ---------- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø·Ø±Ø­â€ŒÙ‡Ø§ (Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÛŒØ§Ø² Ø¬Ø¯ÛŒØ¯) ----------
  // ÙˆØ§Ø­Ø¯ Ù…Ø¨Ù„Øº: ØªÙˆÙ…Ø§Ù†
  const plans = {
    gold123: {
      label: "Ø·Ù„Ø§ÛŒÛŒ Û±Û²Û³Ùª",
      min: 0,          // Ø­Ø¯Ø§Ù‚Ù„ Ø°Ú©Ø± Ù†Ø´Ø¯Ù‡Ø› Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡
      type: "termYield",
      termMonths: 24,
      termYield: 1.23, // Ø³ÙˆØ¯ Ú©Ù„ Ø¯ÙˆØ±Ù‡
    },
    credit: {
      label: "Ø·Ø±Ø­ Ø§Ø¹ØªØ¨Ø§Ø±",
      min: 15000000,
      type: "dailyAPR_withLoan",
      termMonths: 3,
      investAPR: 0.25, // Ø³Ø§Ù„Ø§Ù†Ù‡ Ø±ÙˆØ²Ø´Ù…Ø§Ø±
      loanAPR: 0.23,   // Ø³Ø§Ù„Ø§Ù†Ù‡ Ø±ÙˆØ²Ø´Ù…Ø§Ø±
      loanFactor: 1/3, // ÛŒÚ© Ø³ÙˆÙ… Ø³Ø±Ù…Ø§ÛŒÙ‡
    },
    vip: {
      label: "VIP",
      min: 0,
      type: "dailyAPR_flexible",
      maxAPR: 0.61,
      minAPR: 0.01,
      minMonths: 1,
      maxMonths: 36,
    },
    upfront: {
      label: "Ø³ÙˆØ¯ ÛŒÚ©Ø¬Ø§",
      min: 10000000,
      type: "dailyAPR_upfront",
      termMonths: 5,
      apr: 0.42,       // Ø³Ø§Ù„Ø§Ù†Ù‡ Ø±ÙˆØ²Ø´Ù…Ø§Ø±
    },
  };

  // ---------- Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø¹Ø¯Ø§Ø¯ ----------
  const nfFA = new Intl.NumberFormat('fa-IR');
  const formatNumber = (n) => nfFA.format(n);

  function normalizeDigits(str){
    const fa = 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹', ar = 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©';
    return (str || '').replace(/[\u06F0-\u06F9\u0660-\u0669]/g, d => {
      const i = fa.indexOf(d); if (i > -1) return String(i);
      const j = ar.indexOf(d); if (j > -1) return String(j);
      return d;
    });
  }
  function numberFromInput(val){
    const normalized = normalizeDigits(val);
    const raw = normalized.replace(/[^\d]/g, '');
    return raw ? parseInt(raw, 10) : NaN;
  }
  function formatInputAmount(e){
    const input = e.target;
    const n = numberFromInput(input.value);
    if (Number.isNaN(n)) { input.value = ''; return; }
    input.value = formatNumber(n);
  }

  function setError(msg){ document.getElementById('amountError').textContent = msg || ''; }

  // ---------- Ø±ÙˆØ²Ø´Ù…Ø§Ø±: APR Ø³Ø§Ù„Ø§Ù†Ù‡ â†’ Ù†Ø±Ø® Ù…ÙˆØ«Ø± Ø¯ÙˆØ±Ù‡ (Ù…Ø§Ù‡ Û³Û° Ø±ÙˆØ²Ù‡) ----------
  const proratedByMonths = (apr, months) => apr * ((months * 30) / 365);

  // ---------- UI: ØªØºÛŒÛŒØ± Ø·Ø±Ø­ ----------
  function onPlanChange(){
    const planKey = document.getElementById('plan').value;
    const p = plans[planKey];
    const durationSel = document.getElementById('duration');
    const vipControls = document.getElementById('vipControls');

    durationSel.innerHTML = '';
    vipControls.style.display = 'none';

    if (p.type === 'termYield') {
      // ÙÙ‚Ø· Û²Û´ Ù…Ø§Ù‡Ù‡
      const opt = document.createElement('option');
      opt.value = String(p.termMonths);
      opt.textContent = `${p.termMonths} Ù…Ø§Ù‡Ù‡ â€“ ${Math.round(p.termYield*100)}%`;
      durationSel.appendChild(opt);
      durationSel.disabled = false;
    } else if (p.type === 'dailyAPR_withLoan') {
      // ÙÙ‚Ø· Û³ Ù…Ø§Ù‡Ù‡ (Ø³ÙˆØ¯ Ø¯ÙˆØ±Ù‡ Ø§Ø² APR Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
      const m = p.termMonths;
      const opt = document.createElement('option');
      opt.value = String(m);
      opt.textContent = `${m} Ù…Ø§Ù‡Ù‡`;
      durationSel.appendChild(opt);
      durationSel.disabled = false;
    } else if (p.type === 'dailyAPR_upfront') {
      // ÙÙ‚Ø· Ûµ Ù…Ø§Ù‡Ù‡
      const m = p.termMonths;
      const opt = document.createElement('option');
      opt.value = String(m);
      opt.textContent = `${m} Ù…Ø§Ù‡Ù‡ â€“ Ø³ÙˆØ¯ Ø±ÙˆØ² Ø§ÙˆÙ„`;
      durationSel.appendChild(opt);
      durationSel.disabled = false;
    } else if (p.type === 'dailyAPR_flexible') {
      // VIP: Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ
      vipControls.style.display = '';
      durationSel.disabled = true;
      // Ù…Ù‚Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± Ø®ÙˆØ¯ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ VIP Ø§Ø³Øª
    }

    // Placeholder Ø­Ø¯Ø§Ù‚Ù„
    const minTxt = p.min > 0 ? `Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº ${formatNumber(p.min)} ØªÙˆÙ…Ø§Ù†` : 'Ù…Ø¨Ù„Øº Ø³Ø±Ù…Ø§ÛŒÙ‡ (ØªÙˆÙ…Ø§Ù†)';
    document.getElementById('amount').placeholder = minTxt;

    // Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ø®Ø·Ø§ Ùˆ Ù†ØªÛŒØ¬Ù‡
    setError('');
    document.getElementById('result').innerHTML = '';
  }

  // ---------- Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù‡Ø± Ø·Ø±Ø­ ----------
  function calcTermYield(P, termYield){
    const profit = Math.round(P * termYield);
    const monthly = Math.round(profit / 24);
    return { profit, monthly, finalAmount: P + profit };
  }

  function calcDailyAPR(P, apr, months){
    const r = proratedByMonths(apr, months);        // Ù†Ø±Ø® Ø¯ÙˆØ±Ù‡
    const profit = Math.round(P * r);
    const monthly = Math.round(profit / months);
    return { r, profit, monthly, finalAmount: P + profit };
  }

  function calcCreditPlan(P){
    const pl = plans.credit;
    const inv = calcDailyAPR(P, pl.investAPR, pl.termMonths);
    const loanAmount  = Math.round(P * pl.loanFactor);
    const loanRate    = proratedByMonths(pl.loanAPR, pl.termMonths);
    const loanInterest = Math.round(loanAmount * loanRate);
    return {
      investProfit: inv.profit,
      investMonthly: inv.monthly,
      investRatePct: (inv.r * 100).toFixed(2) + '%',
      finalAmount: P + inv.profit, // Ø§Ø±Ø²Ø´ ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø¯Ø± Ø³Ø±Ø±Ø³ÛŒØ¯
      loanAmount, loanInterest
    };
  }

  function calcUpfront(P){
    const pl = plans.upfront;
    const r = proratedByMonths(pl.apr, pl.termMonths);
    const upfrontInterest = Math.round(P * r); // Ø±ÙˆØ² Ø§ÙˆÙ„ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯
    return {
      ratePct: (r * 100).toFixed(2) + '%',
      upfrontInterest,
      maturityReturn: P
    };
  }

  // ---------- Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ ----------
  function calculate(){
    const planKey = document.getElementById('plan').value;
    const p = plans[planKey];
    const amount = numberFromInput(document.getElementById('amount').value);

    if (Number.isNaN(amount)) { setError('Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.'); return; }
    if (amount < p.min) { setError(`Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº Ø¨Ø±Ø§ÛŒ Â«${p.label}Â» ${formatNumber(p.min)} ØªÙˆÙ…Ø§Ù† Ø§Ø³Øª.`); return; }
    setError('');

    const months = (p.type === 'dailyAPR_flexible')
      ? parseInt(document.getElementById('vipMonths').value, 10)
      : parseInt(document.getElementById('duration').value, 10);

    let html = '';

    if (p.type === 'termYield') {
      const out = calcTermYield(amount, p.termYield);
      html = `
        <div>
          Ù…Ø¯Øª: ${p.termMonths} Ù…Ø§Ù‡Ù‡<br/>
          Ø³ÙˆØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: ${formatNumber(out.monthly)} ØªÙˆÙ…Ø§Ù†<br/>
          Ø³ÙˆØ¯ Ú©Ù„: ${formatNumber(out.profit)} ØªÙˆÙ…Ø§Ù†<br/>
          Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ø¯Ø± Ø³Ø±Ø±Ø³ÛŒØ¯: ${formatNumber(out.finalAmount)} ØªÙˆÙ…Ø§Ù†
        </div>
      `;
    } else if (p.type === 'dailyAPR_withLoan') {
      const out = calcCreditPlan(amount);
      html = `
        <div>
          Ù…Ø¯Øª: ${p.termMonths} Ù…Ø§Ù‡Ù‡ â€¢ Ù†Ø±Ø® Ù…Ø¤Ø«Ø± Ø¯ÙˆØ±Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ: ${out.investRatePct}<br/>
          Ø³ÙˆØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ: ${formatNumber(out.investMonthly)} ØªÙˆÙ…Ø§Ù†<br/>
          Ø³ÙˆØ¯ Ú©Ù„ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ: ${formatNumber(out.investProfit)} ØªÙˆÙ…Ø§Ù†<br/>
          Ø§Ø±Ø²Ø´ ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø¯Ø± Ø³Ø±Ø±Ø³ÛŒØ¯: ${formatNumber(out.finalAmount)} ØªÙˆÙ…Ø§Ù†
          <hr/>
          ÙˆØ§Ù… Ù‚Ø§Ø¨Ù„ Ø¯Ø±ÛŒØ§ÙØª (Û±/Û³ Ø³Ø±Ù…Ø§ÛŒÙ‡): ${formatNumber(out.loanAmount)} ØªÙˆÙ…Ø§Ù†<br/>
          Ø¨Ù‡Ø±Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ ÙˆØ§Ù… Ø·ÛŒ Ø¯ÙˆØ±Ù‡: ${formatNumber(out.loanInterest)} ØªÙˆÙ…Ø§Ù†
        </div>
      `;
    } else if (p.type === 'dailyAPR_flexible') {
      const apr = Math.min(Math.max(parseFloat(document.getElementById('vipAPR').value), p.minAPR), p.maxAPR);
      const out = calcDailyAPR(amount, apr, months);
      html = `
        <div>
          Ù…Ø¯Øª: ${months} Ù…Ø§Ù‡Ù‡ â€¢ APR Ø³Ø§Ù„Ø§Ù†Ù‡ (Ø±ÙˆØ²Ø´Ù…Ø§Ø±): ${(apr*100).toFixed(2)}%<br/>
          Ù†Ø±Ø® Ù…Ø¤Ø«Ø± Ø¯ÙˆØ±Ù‡ â‰ˆ ${(out.r*100).toFixed(2)}%<br/>
          Ø³ÙˆØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: ${formatNumber(out.monthly)} ØªÙˆÙ…Ø§Ù†<br/>
          Ø³ÙˆØ¯ Ú©Ù„: ${formatNumber(out.profit)} ØªÙˆÙ…Ø§Ù†<br/>
          Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ø¯Ø§Ø´Øª Ø¯Ø± Ø³Ø±Ø±Ø³ÛŒØ¯: ${formatNumber(out.finalAmount)} ØªÙˆÙ…Ø§Ù†
        </div>
      `;
    } else if (p.type === 'dailyAPR_upfront') {
      const out = calcUpfront(amount);
      html = `
        <div>
          Ù…Ø¯Øª: ${p.termMonths} Ù…Ø§Ù‡Ù‡ â€¢ Ù†Ø±Ø® Ù…Ø¤Ø«Ø± Ø¯ÙˆØ±Ù‡ â‰ˆ ${out.ratePct}<br/>
          <b>Ø³ÙˆØ¯ Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø±ÙˆØ² Ø§ÙˆÙ„: ${formatNumber(out.upfrontInterest)} ØªÙˆÙ…Ø§Ù†</b><br/>
          Ø¨Ø§Ø²Ú¯Ø´Øª Ø§ØµÙ„ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø¯Ø± Ø³Ø±Ø±Ø³ÛŒØ¯: ${formatNumber(out.maturityReturn)} ØªÙˆÙ…Ø§Ù†
        </div>
      `;
    }

    document.getElementById('result').innerHTML = html;
    updateCounter();
  }

  // ---------- Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ (GAS JSONP) ----------
  const COUNTER_NS  = 'repay_calc_v2';
  const COUNTER_KEY = 'usage_count';
  const API_BASE = 'https://script.google.com/macros/s/AKfycbxkeNkd__in37pKasVS0lhD7ffK7iB2dxS1A7hSgY8R9TngJLjfRwcIp4kuowDs7O-4/exec';
  const URL_GET = `${API_BASE}?op=get&ns=${COUNTER_NS}&key=${COUNTER_KEY}`;
  const URL_HIT = `${API_BASE}?op=hit&ns=${COUNTER_NS}&key=${COUNTER_KEY}`;

  function jsonp(url){
    return new Promise((resolve, reject) => {
      const cb = 'cb_' + Math.random().toString(36).slice(2);
      window[cb] = data => { resolve(data); cleanup(); };
      const s = document.createElement('script');
      s.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + cb;
      s.onerror = () => { reject(); cleanup(); };
      document.body.appendChild(s);
      function cleanup(){ delete window[cb]; s.remove(); }
    });
  }
  function setCount(v){ document.getElementById('useCount').innerText = (v ?? 0); }
  function getCurrentCount(){ jsonp(URL_GET).then(d => setCount(d.value)).catch(() => setCount(0)); }
  function updateCounter(){
    const el = document.getElementById('useCount');
    el.innerText = (parseInt(el.innerText || '0', 10) + 1);
    jsonp(URL_HIT).then(d => setCount(d.value)).catch(() => {});
  }

  // ---------- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ----------
  document.getElementById('amount').addEventListener('input', formatInputAmount);

  // Ù…Ù†ÙˆÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯
  (function initDownloadMenu(){
    const btn = document.getElementById('downloadBtn');
    const menu = document.getElementById('downloadMenu');
    btn.addEventListener('click', () => {
      const isOpen = menu.style.display === 'block';
      menu.style.display = isOpen ? 'none' : 'block';
    });
    document.addEventListener('click', (e) => {
      const within = e.target.closest('.download-wrap');
      if (!within) menu.style.display = 'none';
    });
  })();

  // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
  document.addEventListener('DOMContentLoaded', () => {
    // Ù¾ÛŒØ´â€ŒÙØ±Ø¶: Ø·Ù„Ø§ÛŒÛŒ Û±Û²Û³Ùª
    document.getElementById('plan').value = 'gold123';
    onPlanChange();
    getCurrentCount();
  });
</script>
</body>
</html>
